{extend name="public/base" /}
{block name="content"}
  <div class="layui-fluid">
    <div class="layui-row layui-col-space15">
      <div class="layui-col-md12">
        <div class="layui-card">
          <div class="layui-card-header">修改密码</div>
          <div class="layui-card-body" pad15>

            <form class="layui-form" id="form1" lay-filter="">
              <div class="layui-form-item">
                <label class="layui-form-label">原密码</label>
                <div class="layui-input-inline">
                  <input type="password" name="oldPassword" lay-verify="required" lay-verType="tips" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label">新密码</label>
                <div class="layui-input-inline">
                  <input type="password" name="password" lay-verify="pass|required" lay-verType="tips" autocomplete="off" id="LAY_password" class="layui-input">
                </div>
                <div class="layui-form-mid layui-word-aux">6到16个字符</div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label">确认新密码</label>
                <div class="layui-input-inline">
                  <input type="password" name="repassword" lay-verify="repass|required" lay-verType="tips" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item layui-hide">
                <input type="button" lay-submit lay-filter="submit" id="submit" value="确认">
              </div>
            </form>

          </div>
        </div>
      </div>
    </div>
  </div>
{/block}
{block name="script"}
<script>
  //Demo
  layui.use(['form','jquery'], function () {
    var form = layui.form,
    $ = layui.$;
    form.verify({
      // user_name: [/^[a-zA-Z0-9_-]{8,18}$/,'用户名必须4到16位（字母，数字，下划线，减号）'],
      pass: [/^[\S]{6,12}$/, "密码必须6到12位，且不能出现空格"],
      repass: function (t) {
        if (t !== $("#LAY_password").val()) return "两次密码输入不一致"
      }
    });
    //监听提交
    form.on('submit(demo1)', function (data) {
      layer.msg(JSON.stringify(data.field));
      var index = layer.msg('提交中，请稍候', {icon: 16, time: false, shade: 0.8});
      setTimeout(function () {
        $.ajax({
          type: "post",
          url: "{:url('index/password')}",
          data: $('#form1').serialize(),
          success: function (msg) {
            if (msg['code'] == 1) {
              layer.msg(msg['msg']);
              setTimeout(function () {
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
              }, 1000);
            } else {
              layer.msg(msg['msg']);
            }
          }
        });
      }, 2000);
      return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
    });
  });
</script>
{/block}